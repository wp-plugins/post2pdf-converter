はじめに

「POST2PDF Converter」は、訪問者が投稿や固定ページをPDFファイルとして簡単にダウンロード出来るようにします。

また、管理者は、投稿や固定ベージの先頭または後ろにダウンロード用リンクを簡単に追加出来ます。

特徴
・PDFの作成のためにTCPDF（http://www.tcpdf.org/）を使用。
・投稿や固定ベージの先頭または後ろにダウンロード用リンクを簡単に追加できる。
・簡単な設定。
・管理画面やメッセージは、英語、日本語、ドイツ語(訳：Uli Sobers)に対応。


1.動作環境

・WordPress バージョン2.8 以上
・PHP 5


2.インストール

・ダウンロードしたファイルを解凍し、「post2pdf-converter」フォルダごと、WordPressのプラグインディレクトリ（wp-content/plugins/）にアップロードします。
・WordPressの管理画面の「プラグイン」で、このプラグインを有効化します。
・WordPressの管理画面の「設定」の中の「POST2PDF Converter」という項目で設定を行います。


3.アップデート

WordPressの管理画面で、「POST2PDF Converter」を停止し、インストールの要領でファイルをサーバーにアップロード、上書きした後、再度、有効化する。


4.アンインストール

WordPressの管理画面で、まずプラグインを停止し、削除を実行する。


5.フォントの変更

・「/wp-content/plugins/post2pdf-converter/tcpdf/fonts」ディレクトリに、*.php、*.z、*.ctg.zという名前のファイルを全てアップロードします。
・WordPressの管理画面の「設定」の中の「POST2PDF Converter」に移動します。
・「PDFの設定」の「フォント」と「等幅フォント」オプションにフォント名を入力します。
・PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にします。

※フォントファイルが「xxxx.z」なら、フォント名は、「xxxx」です。
※「等幅フォント」にプロポーショナルフォントを割り当てないで下さい。


6.フォント

6-1.日本語フォント

このプラグインは、次の日本語フォントを搭載しています。

フォント名：cid0jp、kozgopromedium、kozminproregular

TCPDFにバンドルされた日本語フォントでは、完全な日本語PDFを作成出来ません。
しかし、この問題は、より良いTCPDF用の日本語フォントをインストールすることで解決されます。

TCPDF用日本語フォント：http://www.near-mint.com/blog/software/rcjfont-for-tcpdf

・「/wp-content/plugins/post2pdf-converter/tcpdf/fonts」ディレクトリに、*.php、*.z、*.ctg.zという名前のファイルを全てアップロードします。
・WordPressの管理画面の「設定」の中の「POST2PDF Converter」に移動します。
・「PDFの設定」の「フォント」と「等幅フォント」オプションにフォント名を入力します。
・PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にします。

※フォントファイルが「xxxx.z」なら、フォント名は、「xxxx」です。
※「等幅フォント」にプロポーショナルフォントを割り当てないで下さい。

下記のサイトでも、TCPDF用の日本語フォントをダウンロードできます。

http://www.monzen.org/Refdoc/tcpdf_freefontj/


6-2.ラテン文字、ギリシャ文字、キリル文字のためのフォント

このプラグインは、次のラテン文字のフォントを搭載しています。

フォント名：courier、helvetica、times

次のフォントを使用することも出来ますが、PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にする必要があります。

フォント名: pdfacourier、pdfahelvetica、pdfatimes

"FreeFont"や"DejaVu fonts"を使用することも出来ますが、PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にする必要があります。


6-3.簡体中国語のためのフォント

このプラグインは、次の簡体中国語フォントを搭載しています。

フォント名：cid0cs、stsongstdlight


6-4.繁体中国語のためのフォント

このプラグインは、次の繁体中国語フォントを搭載しています。

フォント名：cid0ct、msungstdlight


6-5.ハングルのためのフォント

このプラグインは、次のハングルフォントを搭載しています。

フォント名：cid0kr、hysmyeongjostdmedium


6-6.キリル文字のためのフォント

"FreeFont"、または"DejaVu fonts"を使用することが出来ますが、PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にする必要があります。


6-7.アラビア語のためのフォント

このプラグインは、次のアラビア語フォントを搭載しています。

フォント名：aealarabiya、aefurat

"FreeFont"を使用することも出来ますが、PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にする必要があります。


6-8.ヘブライ語、アルメニア語、グルジア語、エチオピア語、タイ語のためのフォント

"FreeFont"を使用することが出来ますが、PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にする必要があります。


6-9.DejaVu fonts

このプラグインは、次の「DejaVu fonts」を搭載していますが、これらを使用し、PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にする必要があります。

フォント名：dejavusans、dejavusanscondensed、dejavusansextralight、dejavusansmono、dejavuserif、dejavuserifcondensed

「DejaVu fonts」は、ラテン文字、ギリシャ文字、キリル文字をサポートしています。


6-10.FreeFont

このプラグインは、次の「FreeFont」を搭載していますが、これらを使用し、PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にする必要があります。

フォント名：freemono、freesans、freeserif

「FreeFont」は、ラテン文字、ギリシャ文字、キリル文字、アラビア語、ヘブライ語、アルメニア語、グルジア語、エチオピア語、タイ語をサポートしています。


7.フォントの追加

新しいフォントを追加することが出来ます。ただし、インストールするフォントは、TCPDF用に変換されたフォントである必要があります。

7-1.フォントの変換

TrueTypeフォント（*.ttf）を、TCPDF用フォントにコンバートします。

下記のサイトにフォントの変換方法が書かれています。

http://www.tcpdf.org/fonts.php


7-2.フォントのアップロード

1.「/wp-content/plugins/post2pdf-converter/tcpdf/fonts」ディレクトリに、*.php、*.z、*.ctg.zという名前のファイルを全てアップロードします。


7-3.フォントを使う

・WordPressの管理画面の「設定」の中の「POST2PDF Converter」に移動します。
・「PDFの設定」の「フォント」と「等幅フォント」オプションにフォント名を入力します。
・PDFを受け取った相手が同じフォントを持っていなくともPDFを編集出来るようにするなら、「Font subsetting」を無効にします。

※フォントファイルが「xxxx.z」なら、フォント名は、「xxxx」です。
※「等幅フォント」にプロポーショナルフォントを割り当てないで下さい。


8.安全なフォントディレクトリ

プラグインを自動更新すると、追加したフォントは削除されます。

これを防止したいなら、設定画面で「安全なフォントディレクトリ」を有効にして下さい。

「安全なフォントディレクトリ」を有効にする前に、手作業でサーバー上に「/wp-content/tcpdf-fonts/」ディレクトリを作成して下さい。それから、フォントをこのディレクトリにアップロード（移動）し、「安全なフォントディレクトリ」を有効化します。

以上で、元のフォントディレクトリは削除して構いません。

・フォントファイル：プラグインのzipファイルを解凍すると、「/post2pdf-converter/tcpdf/fonts」にあります。
・元のフォントディレクトリ： /あなたのプラグインディレクトリ/post2pdf-converter/tcpdf/fonts

しかしながら、自動更新時に、新しいフォンディレクトリに格納されたフォントは更新されなくなりますので、自身でメンテナンスする必要があります。


9.ショートコード

ショートコードを使えば、任意の投稿や固定ページにダウンロードリンクを挿入することが出来ます。

注意：ショートコードを使う前に、設定画面で「ショートコード」オプションを有効化して下さい。

書式：[pdf]PDF形式でダウンロード[/pdf]

次のように属性を追加することも出来ます。

書式：[pdf id="1643" lang="jpn" file="id" font="cid0jp" monospaced="cid0jp" fontsize="11" subsetting="1" ratio="1.35" header="1" logo="1" logo_file="my_logo.png" logo_width="45" wrap_title="1" footer="1" filters="1" shortcode="1" ffamily="0"]Click here to get a PDF[/pdf]

属性値により、ページ毎に、異なるフォント、画像サイズ、ヘッダーロゴを割り当てることが出来ます。

また、id属性を使って、別のページのダウンロードリンクを作成することも可能です。


・使用可能な属性一覧

id：数字で投稿IDを指定。 例 1245
lang：言語コードでコンテンツの言語を指定。「言語コード一覧」を参照のこと。 例 eng
file：ファイル名をタイトルベース、または投稿IDベースにする。値は「title」または「id」。
* font：デフォルトのフォントを指定。 例 helvetica
* monospaced：デフォルトの等幅フォントを指定。 例 courier
* fontsize：フォントサイズを数字で指定。 例 12
* subsetting：Font subsettingの有効化/無効化を「1」または「0」で指定。
* ratio：画像のサイズを指定。 例 1.25
* header：ヘッダーの表示/非表示を「1」または「0」で指定。
* logo：ヘッダーロゴの表示/非表示を「1」または「0」で指定。
* logo_file：ロゴ画像のファイル名を指定。 例 tcpdf_logo.jpg
* logo_width：ロゴの横幅をmm単位で指定。 例 30
* wrap_title：「1」または「0」で指定。「1」の場合、長いタイトルを折り返す。
* filters：「1」または「0」で指定。「1」の場合、タイトルとコンテンツにWordPressのデフォルトフィルターが適用される。
* footer：フッターの表示/非表示を「1」または「0」で指定。
* shortcode：ショートコードを処理するか、削除するかをを「parse」または「remove」で指定。
* ffamily：PDFファイルが文字化けする場合に「1」を指定する。

注意：id属性を省略した場合は、現在のページの投稿IDが割り当てられます。その他の属性を省略した場合は、現在の設定値が割り当てられます。

・言語コード一覧

afr：アフリカーンス語
sqi：アルバニア語
ara：アラビア語
aze：アゼルバイジャン語
eus：バスク語
bel：ベラルーシ語
bra：ポルトガル語(ブラジル)
cat：カタロニア語
chi：簡体中国語
zho：繁体中国語
hrv：クロアチア語
ces：チェコ語
dan：デンマーク語
nld：オランダ語
eng：英語
est：エストニア語
far：ペルシャ語
fra：フランス語
ger：ドイツ語
gle：アイルランド語
glg：ガリシア語
kat：グルジア語
hat：ハイチ語
heb：ヘブライ語
hun：ハンガリー語
hye：アルメニア語
ind：インドネシア語
ita：イタリア語
jpn：日本語
kor：韓国語
mkd：マケドニア語
msa： マレー語
mlt：マルタ語
ron2：モルダビア語
ron3：モルドバ語
nob：ノルウェー語
pol：ポーランド語
por：ポルトガル語
ron1：ルーマニア語
rus：ロシア語
srp：セルビア語
slv：スロベニア語
spa：スペイン語
swa：スワヒリ語
swe：スウェーデン語
urd：ウルドゥー語
cym：ウェールズ語
yid：イディッシュ語
ltr: その他の言語(記述方向：左から右)
rtl: その他の言語(記述方向：右から左)


10.よくある質問

Q.生成したPDFファイルが文字化けします。。

A.設定画面の「フォントをfont-familyに追加」を有効化して下さい。これでも文字化けが解消しない場合は、このドキュメントの手順に従い、別途、日本語フォントをインストールして下さい。


11.ライセンス

GPL v2


12.このプラグインが気に入ったら

プラグインの開発のサポートをお願いしております。

http://www.near-mint.com/blog/donate


13.履歴

2012/1/2　バージョン 0.2 リリース
 ※TCPDFをバージョン5.9.142にアップデート。
 ※ショートコードでのダウンロードリンクの挿入をサポート。
 ※ソースコードの整形のためのフィルターを追加。
 ※ヘッダーの表示/非表示を設定するためのオプションを追加。
 ※フッターの表示/非表示を設定するためのオプションを追加。
 ※長いタイトルを折り返すためのオプションを追加。
 ※署名の表示/非表示を設定するためのオプションを追加。
 ※WordPress標準フィルターを適用するためのオプションを追加。
 ※投稿タイトル、本文用のフィルターを追加。
 ※各言語用のデフォルトフォントを変更。
 ※tcpdf.phpに２つの文字コードが混在していた問題を修正。

2011/12/30　バージョン 0.1.6 リリース
 ※イメージサイズを変更するためのオプションを追加。
 ※ダウンロードリンクの表示位置の選択肢に「投稿、固定ページの先頭と後ろ」を追加。
 ※キーワードの区切り文字を変更。
 ※サブジェクトが、テキストではなく、タグ付きのHTMLになっている問題を修正。

2011/12/29　バージョン 0.1.5 リリース
 ※ヘッダーロゴを変更するためのオプションを追加。
 ※管理画面、メッセージのドイツ語表示をサポート。（Uli Sobers氏に感謝。）
 ※デフォルトのフォントサイズを変更。
 ※ポーランド語用のデフォルトのフォントを変更。
 ※「フォントをfont-familyに追加」オプションのための正規表現を改善。

2011/12/28　バージョン 0.1.3 リリース
 ※PDFのファイル名を定義するオプションを追加。
 ※デフォルトの等幅フォントを設定するオプションを追加。
 ※フォントを格納するディレクトリを変更するオプションを追加。
 ※CSSを投稿または固定ページのみで読み込むようにpost2pdf_conv_add_style()を更新。
 ※一部の言語において、生成したPDFで文字化けが発生する問題を修正。
 ※コンテンツ内でスタイルが定義され、font-family属性を含む場合に、生成したPDFで文字化けが発生する問題を修正。
 ※ログインユーザーにのみアクセスを許可している場合でも、ゲストに対してダウンロードリンクが表示される不具合を修正。
 ※投稿のタイトルが長い場合に、右端からはみ出す不具合を修正。
 ※システム制限を超える長さのファイル名を付加する可能性がある不具合を修正。

2011/12/27　バージョン 0.1 リリース


14.貢献者のサイト

Uli Sobers（ドイツ語訳）：http://www.free-templates-sobers.de/、http://www.iq137.de/


Redcocker
URL: http://www.near-mint.com/blog/
POST2PDF Converter: http://www.near-mint.com/blog/software/post2pdf-converter
